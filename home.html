<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maps</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>


<body>
    <div id="alerta">
        <h1>Bem vindo ao PrudenTour!</h1>
        <h6>Ande com o Personagem e descubra os atrativos de Prudente</h6>
    </div>
    <div id="map"></div>
    <div id="card" style="display: none;">
        <img src="./img/museu.jpg" alt="" id="card-image">
    </div>

    <img src="./img/giulia.png" alt="" id="character">

    <script>

        
     




        // --------------------------------------------------------------------------



        const map = L.map('map', { maxZoom: 19 }).setView([-22.120530755875148, -51.40559483356016], 16);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        // Coordenadas das atrações
        const points = {
            "SENAI": [-22.120530755875148, -51.40559483356016],
            "Cidade da Criança": [-22.183350843361765, -51.38548184752809],
            "Parque do Povo": [-22.12355275180193, -51.40244938985967],
            "Museu Histórico": [-22.116477209903824, -51.411605061024744]
            // Adicione outras coordenadas aqui...
        };

        // Adicionar marcadores (pinos) para as capitais
        // const markers = [];
        // for (const point in points) {
        //     const marker = L.marker(points[point]);
        //     markers.push({ marker, collisionAlertShown: false }); // Adicione um objeto para rastrear o estado do alerta
        // }

         // Adicionar marcadores (pinos) para as atrações
         const markers = [];
        for (const point in points) {
            markers[point] = L.marker(points[point]);
        }

     
        const character = document.getElementById('character');
        const alerta = document.getElementById('alerta');

        let xPosition = window.innerWidth / 2;
        let yPosition = window.innerHeight / 2;
        let imgfixa = '';
        let imgindex = 0;
        let bgPositionX = 0;
        let step = 10

        character.style.left = window.innerWidth / 2 + 'px';
        character.style.top = window.innerHeight / 2 + 'px';

        alerta.style.left = window.innerWidth / 4 + 'px';
        alerta.style.top = window.innerHeight / 4 + 'px';



        document.addEventListener('keydown', (event) => {
            const key = event.key
            document.getElementById("alerta").style.display = "none";
            if (key === 'ArrowUp') {
                yPosition -= 10;
                imgindex = (imgindex + 1) % 5;
                //character  'scaleX(-1)';
                imgfixa = './img/tras/tras'
                checkCollisions()
            } else if (key === 'ArrowDown') {
                yPosition += 10;
                imgindex = (imgindex + 1) % 8;
                //character  'scaleX(-1)';
                imgfixa = './img/right/giulia'
                checkCollisions()
            } else if (key === 'ArrowLeft') {
                xPosition -= 10;
                imgindex = (imgindex + 1) % 8;
                //character  'scaleX(1)';
                imgfixa = './img/left/esquerda'
                checkCollisions()

            } else if (key === 'ArrowRight') {
                xPosition += 10;
                imgindex = (imgindex + 1) % 8;
                //character  'scaleX(1)';
                imgfixa = './img/right/giulia'
                checkCollisions()
            }



            const imgSrc = `${imgfixa}${imgindex}.png`
            character.src = imgSrc
            character.style.left = xPosition + 'px';
            character.style.top = yPosition + 'px';



        });
        // Função para verificar colisões com os marcadores
        function checkCollisions() {
            const characterRect = character.getBoundingClientRect();
            for (const point in points) {
                const marker = markers[point];
                const markerLatLng = marker.getLatLng();
               // console.log(marker)
                const markerPos = map.latLngToContainerPoint(markerLatLng);

                if (
                    xPosition + characterRect.width > markerPos.x &&
                    xPosition < markerPos.x + 0.1 && // Tamanho aproximado do ícone do marcador
                    yPosition + characterRect.height > markerPos.y &&
                    yPosition < markerPos.y + 0.1 // Tamanho aproximado do ícone do marcador
                ) {
                    alert(`Você encontrou ${point}!`);
                    xPosition = markerPos.x + 50
                    
                    
                }
            }
        }


       // setInterval(checkCollisions, 500); // Verificar colisões a cada 100ms

      
        setTimeout(() => {
            document.getElementById("alerta").style.display = "none";
        }, 5000);

        //Icon point
        var LeafIcon = L.Icon.extend({
            options: {
                iconSize: [50, 50],
                iconAnchor: [22, 94],
                popupAnchor: [-3, -76]
            }
        });

        var Museu = new LeafIcon({ iconUrl: './img/museu.jpg' }),
            PqPovo = new LeafIcon({ iconUrl: './img/parquedopovo.jpg' }),
            SENAI = new LeafIcon({ iconUrl: './img/senai.jpg' });

        L.marker([-22.116477209903824, -51.411605061024744], { icon: Museu }).addTo(map).bindPopup("Museu Histórico");
        L.marker([-22.120530755875148, -51.40559483356016], { icon: SENAI }).addTo(map).bindPopup("SENAI");
        L.marker([-22.12355275180193, -51.40244938985967], { icon: PqPovo }).addTo(map).bindPopup("Parque do Povo");

    </script>
</body>

</html>


